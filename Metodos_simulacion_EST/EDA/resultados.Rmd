# Resultados y discusión

En esta sección se presentarán los resultados del análisis descriptivo de los datos limpios. Este análisis e realizará en torno a los tres objetivos específicos planteados, donde la variable *Response* se adopta como variable objetivo principal, dado que representa la medida directa del comportamiento que se busca predecir en la próxima campaña de marketing.

## Matriz de correlaciones del dataset procesado

Como punto de partida, la Figura \@ref(fig:matriz-cor) presenta la matriz de correlaciones de las principales variables numéricas del dataset imputado, incluyendo *Response* y *AcceptedCmpOverall*.

```{r matriz-cor, echo=FALSE, fig.cap="Matriz de correlaciones de variables numéricas del dataset imputado.", fig.width=11, fig.height=10}
# -------------------------------------------------------------------------
# MATRIZ DE CORRELACIONES POST-IMPUTACIÓN
# -------------------------------------------------------------------------

# Se seleccionan las variables numéricas de mayor relevancia analítica
# Se incorporan Response y AcceptedCmpOverall para evaluar su relación
# con el resto del dataset

vars_cor <- c("Response", "AcceptedCmpOverall",
              "Income", "MntWines", "MntMeatProducts", "MntFishProducts",
              "MntFruits", "MntSweetProducts", "MntGoldProds", "MntTotal",
              "NumWebPurchases", "NumCatalogPurchases", "NumStorePurchases",
              "NumDealsPurchases", "NumWebVisitsMonth",
              "Age", "Recency", "Customer_Days")

cor_matrix <- cor(datos_final[, vars_cor], use = "complete.obs")

corrplot::corrplot(
  cor_matrix,
  method = "color",
  type = "upper",
  tl.col = "black",
  tl.srt = 45,
  addCoef.col = "black",
  number.cex = 0.55,
  number.digits = 2,
  title = "",
  mar = c(0, 0, 1, 0)
)
```

La Figura \@ref(fig:matriz-cor) se pueden identificar las variables con mayor asociación lineal con *Response*. La correlación más alta corresponde a *AcceptedCmpOverall* (r = 0.42), lo cual confirma que el historial de aceptación de campañas previas es el indicador lineal más fuerte de la respuesta a la campaña piloto, y le siguen en orden de magnitud, *MntTotal* (r = 0.26), *MntMeatProducts* (r = 0.25), *NumCatalogPurchases* (r = 0.24), *Recency* (r = −0.21), *Customer_Days* (r = 0.19), *Income* (r = 0.17) y *MntWines* (r = 0.17), y *MntGoldProds* y *NumWebPurchases* (r = 0.15). Las demás variables numéricas exhiben correlaciones prácticamente nulas.

## Relación entre Response y AcceptedCmpOverall

Antes de profundizar en el análisis bivariado, se examina la relación entre *Response* y *AcceptedCmpOverall*. Si bien ambas capturan información sobre la receptividad del cliente a ofertas comerciales, cumplen roles distintos: *Response* es el resultado de interés (variable objetivo), mientras que *AcceptedCmpOverall* resume el historial de aceptación previo y constituye, por tanto, un potencial predictor.

```{r response-vs-overall, echo=FALSE, fig.cap="Distribución de AcceptedCmpOverall según grupo de respuesta a la campaña piloto.", fig.width=8, fig.height=5}
# -------------------------------------------------------------------------
# RELACIÓN ENTRE RESPONSE Y ACCEPTEDCMPOVERALL
# -------------------------------------------------------------------------

# Se crea una variable categórica para facilitar la visualización
datos_final <- datos_final %>%
  mutate(Response_label = factor(Response, levels = c(0, 1),
                                  labels = c("No aceptó", "Aceptó")))

ggplot(datos_final, aes(x = factor(AcceptedCmpOverall), fill = Response_label)) +
  geom_bar(position = "fill", alpha = 0.85, color = "grey30", linewidth = 0.3) +
  scale_fill_manual(values = c("No aceptó" = "pink", "Aceptó" = "#BAC095"),
                    name = "Campaña piloto") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Proporción de respuesta a la campaña piloto según campañas previas aceptadas",
    x = "Número de campañas previas aceptadas (AcceptedCmpOverall)",
    y = "Proporción"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 11, hjust = 0.5))
```

```{r tabla-response-overall, echo=FALSE}
# -------------------------------------------------------------------------
# TABLA DE PROPORCIONES RESPONSE × ACCEPTEDCMPOVERALL
# -------------------------------------------------------------------------

tabla_resp_overall <- datos_final %>%
  group_by(AcceptedCmpOverall, Response_label) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(AcceptedCmpOverall) %>%
  mutate(
    Total = sum(n),
    Porcentaje = round(n / Total * 100, 1)
  ) %>%
  filter(Response_label == "Aceptó") %>%
  select(AcceptedCmpOverall, Total, n, Porcentaje) %>%
  rename(
    `Campañas previas` = AcceptedCmpOverall,
    `Total clientes` = Total,
    `Aceptaron piloto` = n,
    `% Aceptación` = Porcentaje
  )

knitr::kable(
  tabla_resp_overall,
  format = "html",
  caption = "Tasa de aceptación de la campaña piloto según historial de campañas previas",
  align = c("c", "c", "c", "c")
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "responsive"),
    full_width = FALSE
  ) %>%
  column_spec(1, bold = TRUE)
```

La Figura \@ref(fig:response-vs-overall) y la Tabla \@ref(tab:tabla-response-overall) indican que la proporción de clientes que aceptaron la campaña piloto crece de manera consistente a medida que aumenta el número de campañas previas aceptadas. Mientras que entre quienes no habían aceptado ninguna campaña previa la tasa de respuesta es baja, esta se incrementa sustancialmente en clientes con historial de aceptación.

## Análisis bivariado: variables numéricas por grupo de respuesta

Para evaluar formalmente si las diferencias observadas entre los grupos que aceptaron y no aceptaron la campaña piloto son estadísticamente significativas, se emplea la prueba de Mann-Whitney, prueba no paramétrica adecuada dado que las variables analizadas no satisfacen, en general, el supuesto de normalidad. Se complementa con el coeficiente de correlación de rango biserial ($r_{rb}$) como medida del tamaño del efecto. Los umbrales interpretativos convencionales son: $|r| < 0.1$ (despreciable), $0.1 \leq |r| < 0.3$ (pequeño), $0.3 \leq |r| < 0.5$ (moderado), $|r| \geq 0.5$ (grande).

Se seleccionan las variables numéricas con base en su correlación con *Response* según la Figura \@ref(fig:matriz-cor), priorizando aquellas con $|r| \geq 0.15$ e incluyendo también variables con correlación baja para contrastar.

```{r boxplot-numerico-response, echo=FALSE, fig.cap="Boxplots comparativos de variables numéricas por grupo de respuesta.", fig.width=12, fig.height=14}
# -------------------------------------------------------------------------
# BOXPLOTS COMPARATIVOS POR GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

# Variables ordenadas por correlación con Response (de mayor a menor |r|)
vars_numericas_biv <- c("MntTotal", "MntMeatProducts", "NumCatalogPurchases",
                        "Recency", "Customer_Days", "Income", "MntWines",
                        "MntGoldProds", "NumWebPurchases",
                        "NumDealsPurchases", "NumWebVisitsMonth", "Age")

plots_box <- lapply(vars_numericas_biv, function(var) {
  ggplot(datos_final, aes(x = Response_label, y = .data[[var]],
                           fill = Response_label)) +
    geom_boxplot(alpha = 0.7, outlier.colour = "black", outlier.size = 1) +
    scale_fill_manual(values = c("No aceptó" = "pink", "Aceptó" = "#BAC095")) +
    labs(title = var, x = "", y = "") +
    theme_minimal() +
    theme(legend.position = "none",
          plot.title = element_text(face = "bold", size = 9, hjust = 0.5))
})

do.call(gridExtra::grid.arrange, c(plots_box, ncol = 3))
```

```{r mann-whitney-response, echo=FALSE}
# -------------------------------------------------------------------------
# TEST DE MANN-WHITNEY Y ESTADÍSTICOS DESCRIPTIVOS POR GRUPO
# -------------------------------------------------------------------------

# Estadísticos descriptivos por grupo
resultados_biv_num <- datos_final %>%
  group_by(Response_label) %>%
  summarise(across(all_of(vars_numericas_biv),
                   list(Media = ~round(mean(.x), 2),
                        Mediana = ~round(median(.x), 2),
                        DE = ~round(sd(.x), 2)),
                   .names = "{.col}_{.fn}"),
            .groups = "drop") %>%
  pivot_longer(cols = -Response_label,
               names_to = c("Variable", ".value"),
               names_sep = "_(?=[^_]+$)") %>%
  pivot_wider(names_from = Response_label,
              values_from = c(Media, Mediana, DE),
              names_glue = "{.value}_{Response_label}")

# p-valores del test de Mann-Whitney
p_valores <- data.frame(
  Variable = vars_numericas_biv,
  p_valor = sapply(vars_numericas_biv, function(v) {
    round(wilcox.test(reformulate("Response", response = v),
                      data = datos_final)$p.value, 4)
  }),
  stringsAsFactors = FALSE
)

resultados_biv_num <- resultados_biv_num %>%
  left_join(p_valores, by = "Variable")
```

```{r effect-sizes-num, echo=FALSE}
# -------------------------------------------------------------------------
# TAMAÑO DEL EFECTO: CORRELACIÓN DE RANGO BISERIAL
# -------------------------------------------------------------------------

efecto_num <- data.frame(
  Variable = vars_numericas_biv,
  r_rank_biserial = sapply(vars_numericas_biv, function(v) {
    test <- wilcox.test(reformulate("Response", response = v),
                        data = datos_final)
    n0 <- sum(datos_final$Response == 0)
    n1 <- sum(datos_final$Response == 1)
    U <- test$statistic
    r <- 1 - (2 * U) / (n0 * n1)
    round(r, 3)
  }),
  stringsAsFactors = FALSE
)

efecto_num <- efecto_num %>%
  mutate(
    Magnitud = case_when(
      abs(r_rank_biserial) < 0.1 ~ "Despreciable",
      abs(r_rank_biserial) < 0.3 ~ "Pequeño",
      abs(r_rank_biserial) < 0.5 ~ "Moderado",
      TRUE ~ "Grande"
    )
  )

# Tabla unificada: descriptivos + p-valor + tamaño del efecto
tabla_biv_completa <- resultados_biv_num %>%
  left_join(efecto_num, by = "Variable")
```


<div style="overflow-x: auto; width: 100%;">
```{r tabla-biv-numerica, echo=FALSE}
knitr::kable(
  tabla_biv_completa,
  format = "html",
  caption = "Comparación de variables numéricas por grupo de respuesta: estadísticos descriptivos, prueba de Mann-Whitney y tamaño del efecto",
  align = c("l", rep("r", ncol(tabla_biv_completa) - 1))
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "responsive"),
    full_width = FALSE
  ) %>%
  column_spec(1, bold = TRUE)
```
</div>

A partir de la Figura \@ref(fig:boxplot-numerico-response) y la Tabla \@ref(tab:tabla-biv-numerica), se presenta la interpretación de los resultados organizados por magnitud del efecto.

**Variables con efecto moderado a grande:**

*MntTotal* constituye el principal diferenciador conductual del análisis. Los clientes que aceptaron la campaña presentan un gasto total acumulado sustancialmente superior al del grupo que la rechazó.

*MntMeatProducts* exhibe un comportamiento similar, con diferencias marcadas entre ambos grupos. 

*NumCatalogPurchases* muestra diferencias claras entre ambos grupos. Los clientes que aceptaron la campaña realizan considerablemente más compras por catálogo. Este resultado es coherente con la naturaleza de la campaña piloto, que fue ejecutada mediante contacto telefónico, un canal conceptualmente próximo al catálogo.

*Recency* presenta una asociación negativa significativa: los clientes que aceptaron la campaña realizaron su última compra más recientemente. 

*Customer_Days* muestra una diferencia estadísticamente significativa: los clientes de mayor antigüedad presentan mayor propensión a aceptar. 

**Variables con efecto pequeño:**

En el caso de *Income* y *MntWines*, si bien el tamaño del efecto es pequeño, estas variables podrían aportar capacidad explicativa complementaria en un modelo multivariante, particularmente considerando que *Income* presenta correlaciones altas con las variables de gasto (*MntWines* y *MntMeatProducts* según la Figura \@ref(fig:matriz-cor)), lo que sugiere que actúa como variable latente de capacidad económica que sustenta los patrones de consumo observados.

Respecto a *MntGoldProds* y *NumWebPurchases*  el gasto ligeramente superior en productos oro del grupo que aceptó podría reflejar una inclinación hacia productos de nicho o premium, mientras que las compras web indican cierta actividad digital orientada a la compra.

**Variables sin efecto significativo:**

Finalmente, *NumDealsPurchases*, *NumWebVisitsMonth* y *Age* no presentan diferencias significativas entre grupos. En particular, la ausencia de efecto de la edad indica que la propensión a aceptar no se asocia con la variable generacional, y la irrelevancia de las visitas web confirma que la navegación pasiva no se traduce en receptividad a ofertas de marketing directo. En el caso de *NumDealsPurchases* la dependencia de descuentos no discrimina entre grupos, lo que sugiere que la sensibilidad al precio no constituye un factor diferenciador para la respuesta a este tipo de campaña.

## Análisis bivariado: variables categóricas por grupo de respuesta

Para las variables categóricas se emplea la prueba Chi-cuadrado de independencia, complementada con el coeficiente V de Cramér como medida del tamaño del efecto. Los umbrales interpretativos para V de Cramér son: $V < 0.1$ (despreciable), $0.1 \leq V < 0.3$ (pequeño), $0.3 \leq V < 0.5$ (moderado), $V \geq 0.5$ (grande).


```{r reconstruccion-categoricas, echo=FALSE}
# -------------------------------------------------------------------------
# RECONSTRUCCIÓN DE VARIABLES CATEGÓRICAS
# -------------------------------------------------------------------------

datos_final <- datos_final %>%
  mutate(
    Education = case_when(
      education_PhD == 1 ~ "PhD",
      education_Master == 1 ~ "Master",
      education_Graduation == 1 ~ "Graduado",
      education_2n.Cycle == 1 ~ "2do Ciclo",
      education_Basic == 1 ~ "Básica",
      TRUE ~ NA_character_
    ),
    Education = factor(Education,
                       levels = c("Básica", "2do Ciclo", "Graduado", "Master", "PhD")),
    Marital = case_when(
      marital_Divorced == 1 ~ "Divorciado",
      marital_Married == 1 ~ "Casado",
      marital_Single == 1 ~ "Soltero",
      marital_Together == 1 ~ "En pareja",
      marital_Widow == 1 ~ "Viudo",
      TRUE ~ NA_character_
    ),
    Marital = factor(Marital,
                     levels = c("Soltero", "Divorciado", "Viudo", "En pareja", "Casado"))
  )
```

### Nivel educativo

```{r education-response, echo=FALSE, fig.cap="Tasa de aceptación de la campaña piloto por nivel educativo.", fig.width=9, fig.height=5}
# -------------------------------------------------------------------------
# NIVEL EDUCATIVO POR GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

tasa_edu <- datos_final %>%
  filter(!is.na(Education)) %>%
  group_by(Education) %>%
  summarise(
    Total = n(),
    Aceptaron = sum(Response == 1),
    Tasa = round(Aceptaron / Total * 100, 1),
    .groups = "drop"
  )

ggplot(tasa_edu, aes(x = Education, y = Tasa, fill = Education)) +
  geom_col(alpha = 0.85, color = "grey30", linewidth = 0.3, show.legend = FALSE) +
  geom_text(aes(label = paste0(Tasa, "%")), vjust = -0.5, size = 3.5, fontface = "bold") +
  scale_fill_manual(values = c("Básica" = "pink", "2do Ciclo" = "#D4A5A5",
                                "Graduado" = "#C9B8A8", "Master" = "#BAC095",
                                "PhD" = "#5A6E3A")) +
  labs(
    title = "Tasa de aceptación de la campaña piloto por nivel educativo",
    x = "Nivel educativo",
    y = "Tasa de aceptación (%)"
  ) +
  ylim(0, max(tasa_edu$Tasa) * 1.2) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))
```

### Estado civil

```{r marital-response, echo=FALSE, fig.cap="Tasa de aceptación de la campaña piloto por estado civil.", fig.width=9, fig.height=5}
# -------------------------------------------------------------------------
# ESTADO CIVIL POR GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

tasa_marital <- datos_final %>%
  filter(!is.na(Marital)) %>%
  group_by(Marital) %>%
  summarise(
    Total = n(),
    Aceptaron = sum(Response == 1),
    Tasa = round(Aceptaron / Total * 100, 1),
    .groups = "drop"
  )

ggplot(tasa_marital, aes(x = Marital, y = Tasa, fill = Marital)) +
  geom_col(alpha = 0.85, color = "grey30", linewidth = 0.3, show.legend = FALSE) +
  geom_text(aes(label = paste0(Tasa, "%")), vjust = -0.5, size = 3.5, fontface = "bold") +
  scale_fill_manual(values = c("Soltero" = "#5A6E3A", "Divorciado" = "#BAC095",
                                "Viudo" = "#C9B8A8", "En pareja" = "pink",
                                "Casado" = "#D4A5A5")) +
  labs(
    title = "Tasa de aceptación de la campaña piloto por estado civil",
    x = "Estado civil",
    y = "Tasa de aceptación (%)"
  ) +
  ylim(0, max(tasa_marital$Tasa) * 1.2) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))
```

### Composición del hogar

```{r hogar-response, echo=FALSE, fig.cap="Tasa de aceptación según composición del hogar (niños y adolescentes).", fig.width=10, fig.height=5}
# -------------------------------------------------------------------------
# COMPOSICIÓN DEL HOGAR POR GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

tasa_kid <- datos_final %>%
  group_by(Kidhome) %>%
  summarise(
    Total = n(),
    Aceptaron = sum(Response == 1),
    Tasa = round(Aceptaron / Total * 100, 1),
    .groups = "drop"
  ) %>%
  mutate(Variable = "Niños (Kidhome)")

tasa_teen <- datos_final %>%
  group_by(Teenhome) %>%
  summarise(
    Total = n(),
    Aceptaron = sum(Response == 1),
    Tasa = round(Aceptaron / Total * 100, 1),
    .groups = "drop"
  ) %>%
  mutate(Variable = "Adolescentes (Teenhome)")

tasa_kid <- tasa_kid %>% rename(Cantidad = Kidhome)
tasa_teen <- tasa_teen %>% rename(Cantidad = Teenhome)
tasa_hogar <- bind_rows(tasa_kid, tasa_teen)

ggplot(tasa_hogar, aes(x = factor(Cantidad), y = Tasa, fill = Variable)) +
  geom_col(position = "dodge", alpha = 0.85, color = "grey30", linewidth = 0.3) +
  geom_text(aes(label = paste0(Tasa, "%")),
            position = position_dodge(width = 0.9),
            vjust = -0.5, size = 3, fontface = "bold") +
  scale_fill_manual(values = c("Niños (Kidhome)" = "pink",
                                "Adolescentes (Teenhome)" = "#BAC095"),
                    name = "Variable") +
  labs(
    title = "Tasa de aceptación según número de niños y adolescentes en el hogar",
    x = "Cantidad de hijos en el hogar",
    y = "Tasa de aceptación (%)"
  ) +
  ylim(0, max(tasa_hogar$Tasa) * 1.2) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        legend.position = "bottom")
```

### Pruebas de independencia

```{r chi-cuadrado, echo=FALSE}
# -------------------------------------------------------------------------
# PRUEBAS CHI-CUADRADO Y V DE CRAMER
# -------------------------------------------------------------------------

library(vcd)

vars_cat_test <- c("Education", "Marital", "Kidhome", "Teenhome")

resultados_chi2 <- data.frame(
  Variable = character(),
  Chi2 = numeric(),
  gl = integer(),
  p_valor = numeric(),
  V_Cramer = numeric(),
  Magnitud = character(),
  stringsAsFactors = FALSE
)

for (v in vars_cat_test) {
  datos_test <- datos_final %>% filter(!is.na(.data[[v]]))
  tabla <- table(datos_test[[v]], datos_test$Response)
  test <- chisq.test(tabla)
  stats <- assocstats(tabla)
  vc <- stats$cramer

  magnitud <- if (vc < 0.1) "Despreciable"
              else if (vc < 0.3) "Pequeño"
              else if (vc < 0.5) "Moderado"
              else "Grande"

  resultados_chi2 <- rbind(
    resultados_chi2,
    data.frame(Variable = v,
               Chi2 = round(test$statistic, 2),
               gl = test$parameter,
               p_valor = round(test$p.value, 4),
               V_Cramer = round(vc, 3),
               Magnitud = magnitud)
  )
}

knitr::kable(
  resultados_chi2,
  format = "html",
  caption = "Pruebas de Chi-cuadrado y V de Cramér para variables categóricas",
  col.names = c("Variable", "$\\chi^2$", "gl", "p-valor", "V de Cramér", "Magnitud"),
  row.names = FALSE,
  escape = FALSE
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "responsive"),
    full_width = FALSE
  ) %>%
  column_spec(1, bold = TRUE)
```

La Tabla \@ref(tab:chi-cuadrado) presenta los resultados de las pruebas de independencia para las variables categóricas.

El nivel educativo muestra una asociación significativa con *Response*: como se observa en la Figura \@ref(fig:education-response), los clientes con doctorado presentan la mayor tasa de aceptación, seguidos por aquellos con maestría, mientras que los niveles más bajos registran tasas inferiores. Este gradiente podría estar parcialmente mediado por el ingreso, dado que niveles educativos superiores suelen asociarse con mayor capacidad adquisitiva.

En cuanto al estado civil, la Figura \@ref(fig:marital-response) revela que los clientes solteros, divorciados y viudos tienden a presentar mayores tasas de respuesta frente a quienes están casados o en pareja. Este patrón podría reflejar diferencias en la estructura del gasto del hogar: clientes sin pareja disponen de mayor autonomía en sus decisiones de compra.

En el caso de la composición del hogar analizada en la Figura \@ref(fig:hogar-response), tenemos que la tasa de aceptación disminuye a medida que aumenta el número de niños o adolescentes en el hogar. Esto sugiere que la presencia de dependientes reduce la disposición del cliente para adquirir nuevos productos, posiblemente debido a restricciones presupuestarias o prioridades distintas.

## Perfil del gasto por categoría de producto y canal de compra

En línea con el segundo objetivo específico, se profundiza en la diferenciación del gasto por categoría de producto entre ambos grupos de respuesta.

Tal como se documentó en la sección de procesamiento, muchas variables de gasto presentan distribuciones con fuerte asimetría positiva y alta concentración en valores bajos, acompañadas de colas superiores extendidas. Esta distribución de los datos hace que la media resulte sensible a dichos valores extremos, por lo que en los análisis comparativos que siguen se emplea la mediana como medida de tendencia central, complementada con la media para evidenciar el grado de asimetría.

```{r gasto-response, echo=FALSE, fig.cap="Gasto mediano por categoría de producto según grupo de respuesta.", fig.width=10, fig.height=6}
# -------------------------------------------------------------------------
# GASTO POR CATEGORÍA Y GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

vars_gasto <- c("MntWines", "MntMeatProducts", "MntFishProducts",
                "MntFruits", "MntSweetProducts", "MntGoldProds")

gasto_por_grupo <- datos_final %>%
  group_by(Response_label) %>%
  summarise(across(all_of(vars_gasto), median), .groups = "drop") %>%
  pivot_longer(cols = all_of(vars_gasto),
               names_to = "Categoria",
               values_to = "Mediana_gasto") %>%
  mutate(
    Categoria = str_replace(Categoria, "Mnt", ""),
    Categoria = factor(Categoria,
                       levels = c("Wines", "MeatProducts", "FishProducts",
                                  "Fruits", "SweetProducts", "GoldProds"),
                       labels = c("Vinos", "Carnes", "Pescado",
                                  "Frutas", "Dulces", "Oro"))
  )

ggplot(gasto_por_grupo, aes(x = Categoria, y = Mediana_gasto,
                             fill = Response_label)) +
  geom_col(position = "dodge", alpha = 0.85, color = "grey30", linewidth = 0.3) +
  geom_text(aes(label = round(Mediana_gasto, 0)),
            position = position_dodge(width = 0.9),
            vjust = -0.5, size = 3, fontface = "bold") +
  scale_fill_manual(values = c("No aceptó" = "pink", "Aceptó" = "#BAC095"),
                    name = "Campaña piloto") +
  labs(
    title = "Gasto mediano por categoría de producto según grupo de respuesta",
    x = "Categoría de producto",
    y = "Gasto mediano (u.m.)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        legend.position = "bottom")
```

```{r tabla-gasto-response, echo=FALSE}
# -------------------------------------------------------------------------
# TABLA COMPARATIVA DE GASTO POR GRUPO
# -------------------------------------------------------------------------

tabla_gasto <- datos_final %>%
  group_by(Response_label) %>%
  summarise(
    across(all_of(vars_gasto),
           list(Mediana = median, Media = ~round(mean(.x), 1)),
           .names = "{.col}_{.fn}"),
    MntTotal_Mediana = median(MntTotal),
    MntTotal_Media = round(mean(MntTotal), 1),
    .groups = "drop"
  )

gasto_long <- tabla_gasto %>%
  pivot_longer(-Response_label, names_to = "Variable", values_to = "Valor") %>%
  pivot_wider(names_from = Response_label, values_from = Valor) %>%
  separate(Variable, into = c("Categoria", "Estadistico"), sep = "_(?=[^_]+$)") %>%
  mutate(
    Categoria = str_replace(Categoria, "Mnt", ""),
    Categoria = case_when(
      Categoria == "Wines" ~ "Vinos",
      Categoria == "MeatProducts" ~ "Carnes",
      Categoria == "FishProducts" ~ "Pescado",
      Categoria == "Fruits" ~ "Frutas",
      Categoria == "SweetProducts" ~ "Dulces",
      Categoria == "GoldProds" ~ "Oro",
      Categoria == "Total" ~ "Total",
      TRUE ~ Categoria
    )
  )

knitr::kable(
  gasto_long,
  format = "html",
  caption = "Estadísticos de gasto por categoría y grupo de respuesta",
  col.names = c("Categoría", "Estadístico", "No aceptó", "Aceptó"),
  align = c("l", "l", "r", "r")
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "responsive"),
    full_width = FALSE
  ) %>%
  column_spec(1, bold = TRUE) %>%
  collapse_rows(columns = 1, valign = "middle")
```

La Figura \@ref(fig:gasto-response) y la Tabla \@ref(tab:tabla-gasto-response) evidencian diferencias sustanciales en el gasto entre ambos grupos a lo largo de todas las categorías. Las diferencias más pronunciadas se concentran en vinos y carnes, las dos categorías con mayor volumen de gasto absoluto.

Analicemos ahora los canales de compra. 

```{r canales-response, echo=FALSE, fig.cap="Mediana de compras por canal según grupo de respuesta.", fig.width=10, fig.height=5}
# -------------------------------------------------------------------------
# CANALES DE COMPRA POR GRUPO DE RESPUESTA
# -------------------------------------------------------------------------

vars_canales <- c("NumWebPurchases", "NumCatalogPurchases",
                  "NumStorePurchases", "NumDealsPurchases")

canales_grupo <- datos_final %>%
  group_by(Response_label) %>%
  summarise(across(all_of(vars_canales), median), .groups = "drop") %>%
  pivot_longer(cols = all_of(vars_canales),
               names_to = "Canal",
               values_to = "Mediana") %>%
  mutate(
    Canal = case_when(
      Canal == "NumWebPurchases" ~ "Web",
      Canal == "NumCatalogPurchases" ~ "Catálogo",
      Canal == "NumStorePurchases" ~ "Tienda",
      Canal == "NumDealsPurchases" ~ "Ofertas"
    ),
    Canal = factor(Canal, levels = c("Catálogo", "Web", "Tienda", "Ofertas"))
  )

ggplot(canales_grupo, aes(x = Canal, y = Mediana, fill = Response_label)) +
  geom_col(position = "dodge", alpha = 0.85, color = "grey30", linewidth = 0.3) +
  geom_text(aes(label = Mediana),
            position = position_dodge(width = 0.9),
            vjust = -0.5, size = 3.5, fontface = "bold") +
  scale_fill_manual(values = c("No aceptó" = "pink", "Aceptó" = "#BAC095"),
                    name = "Campaña piloto") +
  labs(
    title = "Compras medianas por canal según grupo de respuesta",
    x = "Canal de compra",
    y = "Mediana de compras"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        legend.position = "bottom")
```

La Figura \@ref(fig:canales-response) revela que la diferencia más marcada entre grupos se concentra en el canal de catálogo. Los clientes que aceptaron la campaña realizan considerablemente más compras por esta vía, mientras que los canales de tienda física y ofertas presentan diferencias mínimas entre ambos grupos.

## Discusión


**En relación con el primer objetivo** (caracterización sociodemográfica), los resultados indican que las variables demográficas clásicas como la edad no constituyen factores discriminantes significativos. Sin embargo, el ingreso, el nivel educativo y la composición del hogar sí presentan diferencias relevantes entre grupos. Los clientes que aceptaron la campaña tienden a tener mayores ingresos, mayor nivel educativo y menos dependientes en el hogar. El estado civil también muestra diferencias, con mayor receptividad entre clientes solteros, divorciados y viudos, lo que podría reflejar mayor autonomía en las decisiones de compra o mayor ingreso discrecional disponible.

**En relación con el segundo objetivo** (patrones de consumo), las variables transaccionales emergen como los principales diferenciadores. El gasto total acumulado (*MntTotal*) presenta el mayor tamaño del efecto entre todas las variables numéricas, seguido de cerca por *MntMeatProducts*. Las diferencias en gasto son consistentes a lo largo de todas las categorías de producto, siendo más pronunciadas en vinos y carnes. En cuanto a los canales, las compras por catálogo constituyen el canal con mayor poder discriminante, mientras que las compras en tienda y con descuento no diferencian entre grupos. Esto sugiere que el cliente respondiente no es simplemente un comprador frecuente, sino que se caracteriza por un patrón de compra específico: alto volumen de gasto, preferencia por canales de venta directa y baja dependencia de descuentos.

**En relación con el tercer objetivo** (identificación de variables diferenciadoras), el análisis permite clasificar las variables en tres niveles de relevancia para la futura construcción del modelo predictivo. En el primer nivel se ubican las variables con mayor poder discriminante: *AcceptedCmpOverall*, *MntTotal*, *MntMeatProducts*, *NumCatalogPurchases* y *Recency*. En el segundo nivel, variables con efecto pequeño pero significativo: *Income*, *MntWines*, *Customer_Days*, *MntGoldProds* y *NumWebPurchases*, así como las variables categóricas *Education*, *Marital*, *Kidhome* y *Teenhome*. En el tercer nivel, las variables sin capacidad discriminante: *Age*, *NumWebVisitsMonth*, *NumDealsPurchases* y *NumStorePurchases*.

Es importante señalar que la alta correlación entre *Income* y las variables de gasto (documentada en la Figura \@ref(fig:matriz-cor)) implica que estas variables capturan parcialmente la misma dimensión latente de capacidad económica.
